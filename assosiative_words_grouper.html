<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Theodore (Teddy) Lazebnik</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Theodore (Teddy) Lazebnik personal website" name="description">
    <meta content="Teddy Lazebnik" name="author">
	<link rel='icon' href='img/favicon.ico' type='image/x-icon'/ >
	<!-- css -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/teddy_style.css" rel="stylesheet">
    
	<!-- stemmer logics -->
	<script src="js/stemmers.js"></script>
	<script src="js/PorterStemmer.js"></script>
	

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154895667-1"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-154895667-1');
	</script>
</head>

<body onload="init()">
	<div id="progressBar"></div>
	<div id="ScrollPath"></div>
	<div class="container">
		<div class="row">
			<div class="col-lg-1 col-md-1 col-sm-1">
			
			</div>
			<div class="col-lg-10 col-md-10 col-sm-10">
				<div class="header">
					<h1>
					Theodore (Teddy) Lazebnik
					</h1>
				</div>
				<div class="menu">
					<ul>
						<li><a href="index.html"> Short Bio </a></li>
						<li><a href="publications.html"> Publications </a></li>
						<li><a href="students.html"> Students </a></li>
						<li><a href="opensource.html"> Open Resources </a></li>
						<li><a href="teaching.html"> Teaching </a></li>
						<li><a href="" class="active"> Assosiative Words Grouper </a></li>
					</ul>
				</div>
				<div class="body">
					<div class="fluid-container">
						<div class="row">
						<div class="col-lg-12 col-md-12 col-sm-12">
							<div class="info">
								<h2 style="text-align: center;"> Assosiative Words Grouper </h2>
									<div id="train_panel">
										<p><b>Loading Data Panel</b></p>
										<p>Load the data file you wish to work on. You can download the default data set and upload it as well. <br><b>Note: </b>Loading process may take up to few seconds...<br><br></p>	
										<form style="text-align: left;">
											<div class="form-group">
												<label for="dataFile">Source and reaction data file</label>
												<input class="form-control" type="file" id="dataFile" placeholder="Source and reaction data file">
												<br><a target="_blank" class="btn btn-info pull-right" href="data/source_and_reaction_data.txt">Show Default Set</a>
											</div>
										</form>		

										<p>
											How to use the system:
											<ol>
												<li>Upload the data file (includes the source and reaction words in a list in each line separate by ",".</li>
												<li>You will see the source word and response words (source in the box and the response in a list). Each one will have index next to it.</li>
												<li>Add the indexes of the words of the same group into the "Group words indexes" input box with "," between each index.</li>
												<li>You may add the group to exsiting group using the "add to group" button and feeling the group index. You can add as new group using the "add to new group" button.</li>
												<li>You can go to the next set or previous set each time. A mark saying on which set you are at will be shown on the top of the window.</li>
												<li>Make sure to save the working process from time to time and when you done. The saving will keep your currnet location and groups and be used next time you need to upload your work.</li>
												
												<li><b>Note:</b> Your work will be auto saved each 5 minutes to make sure you do not lost too much work in case you forget to save it yourself.</li>
												
											</ol>
										</p>	

										<form style="text-align: left;">
											<div class="form-group">
												<label for="wordsPeerFile">(One time) Convert your file of peers of words to the dataset needed for the grouper system</label>
												<input class="form-control" type="file" id="wordsPeerFile" placeholder="Source and reaction peers file">
											</div>
										</form>										
										
									</div>
									
									<div id="inferance_panel" style="display: none">
										<div class="row">
											<div class="col-lg-5 col-md-5 col-sm-12"  style="margin: 20px 3.5%; text-align: center; border: 2px black solid; border-radius: 10px; background-color: #eee; ">
												<p id="IndexWord" style="font-size: 18pt;">
													אינדקס בדיקה 
												</p>
											</div>
											<div class="col-lg-5 col-md-5 col-sm-12" style="margin: 20px 3.5%; text-align: center; border: 2px black solid; border-radius: 10px; background-color: #eee; font-size: 18pt;">
												<p id="firstWord" style="font-size: 18pt;">
													מילת גירוי
												</p>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-12 col-md-12 col-sm-12">
												<div class="progress" style="height: 30px; font-weight: bold;">
													<div class="progress-bar" role="progressbar" style="font-size: 14pt; line-height: 1.8; width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100" id="pb">25%</div>
												</div>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-12 col-md-12 col-sm-12" style="text-align: right;">
												<h2 style=" margin-right: 3%;">
													מילות תגובה
												</h2>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-11 col-md-11 col-sm-11"  style="margin-top: 20px; margin-bottom: 20px; margin-left: 4%; margin-right: 4%; text-align: right; border: 2px black solid; border-radius: 10px; background-color: #fdfdfd;">
												<p id="responseWords"  style="font-size: 12pt; max-height: 400px;  overflow-y: auto; overflow-x: auto;">
												</p>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-12 col-md-12 col-sm-12" style="text-align: right;">
												<h2 style=" margin-right: 3%;">
													קבוצות
												</h2>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-11 col-md-11 col-sm-11"  style="margin-top: 20px; margin-bottom: 20px; margin-left: 4%; margin-right: 4%; text-align: right; border: 2px black solid; border-radius: 10px; background-color: #fdfdfd;">
												<p id="groups"  style="font-size: 12pt; max-height: 400px;  overflow-y: auto; overflow-x: auto;">
												</p>
											</div>
										</div>
										<form style="text-align: right;">
											<div class="form-group">
												<label for="group_indexes">האינקסים של המילים</label>
												<input class="form-control" type="text" id="group_indexes" placeholder="רשום את האינקסים של המילים פה כאשר ביניהם יש פסיק">
												<small>לדגומה: 0,1,4,5,7</small>
											</div>
										</form>
										<div class="row">
											<div class="col-lg-6 col-md-6 col-sm-12">
												<div class="form-group">
													<input class="form-control" style="width: 50%; display: inline;" type="text" id="class_index" placeholder="שם הקבוצה">
													<button class="btn btn-warning" onclick="addToGroup();" style="width: 45%; margin-top: 10px; margin-bottom: 10px;">הוסף לקבוצה הנבחרת</button>
												</div>
											</div>
											<div class="col-lg-6 col-md-6 col-sm-12">
												<input class="form-control" style="width: 50%; display: inline;" type="text" id="class_new_index" placeholder="שם חדש לקבוצה">
												<button class="btn btn-warning" onclick="addToNewGroup();" style="width: 45%;  margin-top: 10px; margin-bottom: 10px;">הוסף לקבוצה חדשה</button>
											</div>
										</div>
										<div class="row">
											<div class="col-lg-4 col-md-4 col-sm-12">
												<button class="btn btn-primary btn-lg" onclick="next();" style="width: 100%; margin-top: 10px; margin-bottom: 10px;">לקבוצת המילים הבאה</button>
											</div>
											<div class="col-lg-4 col-md-4 col-sm-12">
												<button class="btn btn-success btn-lg" onclick="downloadData();" style=" width: 100%; margin-top: 10px; margin-bottom: 10px;">שמור עבודה</button>
											</div>
											<div class="col-lg-4 col-md-4 col-sm-12">
												<button class="btn btn-primary btn-lg" onclick="previous();" style="width: 100%; margin-top: 10px; margin-bottom: 10px;">לקבוצת המילים הקודמת</button>
											</div>
										</div>
										<div class="row" style="margin-top: 100px;">
											<div class="col-lg-12 col-md-12 col-sm-12">
												<div class="form-group">
													<input class="form-control" style="width: 50%; display: inline;" min="0" type="number" id="jump_index" placeholder=" אינדקס הסט שתרצה לעבור אליו">
													<button class="btn btn-danger" onclick="jumpWordIndex();" style="width: 45%; margin-top: 10px; margin-bottom: 10px;">עבור לסט מילים המתאים</button>
												</div>
											</div>
										</div>
									</div>
							</div>
						</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<!-- Random image generator -->
	<script>
	
	let data = "";
	let groups = [];
	let readyData = [];
	let sourceWords = [];
	let wordIndex = 0;
	let isChangeDone = false;
	let CLUSTER_DATA_SPLITER = "---CLUSTERS DATA BELOW HERE---";
	
	function init()
	{
	  document.getElementById('dataFile').addEventListener('change', LoadDataFile, false);
	  document.getElementById('wordsPeerFile').addEventListener('change', wordsPeerFileLoad, false);
	}

	function LoadDataFile(event)
	{
	  const reader = new FileReader();
	  reader.onload = DataFileLoaded;
	  reader.readAsText(event.target.files[0]);
	}

	function DataFileLoaded(event)
	{
		data = event.target.result;
		document.getElementById('train_panel').style.display = "none";
		document.getElementById('inferance_panel').style.display = "";
		loadScreen();
	}

	function wordsPeerFileLoad(event)
	{
	  const reader = new FileReader();
	  reader.onload = wordsPeerFileLoaded;
	  reader.readAsText(event.target.files[0]);
	}

	function wordsPeerFileLoaded(event)
	{
		var peerLines = event.target.result.split("\n");
		var peerTupels = [];
		var source_and_reaction_sets = {};
		for (var i = 0; i < peerLines.length; i++)
		{
			var source_response_words = peerLines[i].split(",");
			if (source_and_reaction_sets[source_response_words[0]] === undefined)
			{
				source_and_reaction_sets[source_response_words[0]] = [];
			}
			source_and_reaction_sets[source_response_words[0]].push(source_response_words[1]);
		}
		var fileFormatString = "";
		for (key in source_and_reaction_sets)
		{
			fileFormatString += key + ",";
			for (var i = 0; i < source_and_reaction_sets[key].length; i++)
			{
				fileFormatString += source_and_reaction_sets[key][i];
				if (i != source_and_reaction_sets[key].length - 1)
				{
					fileFormatString += ",";
				}
			}
			fileFormatString += "\n";
		}
		downloadasTextFile("grouper_file_system_ready" + getCurrentTimeDateString() + ".csv", fileFormatString);
	}
	
	function loadScreen()
	{
		var clustersFlag = false;
		var clustersFirstLineIndex = 0;
		
		var list_data = data.split("\n");
		readyData = [];
		for (var i = 0; i < list_data.length; i++)
		{
			// stop here and start adding to clusters
			if (list_data[i] == CLUSTER_DATA_SPLITER)
			{
				clustersFirstLineIndex = i + 1;
				clustersFlag = true;
				break;
			}
			var new_row = [];
			if (list_data[i].length < 5)
			{
				continue;
			}
			var items = list_data[i].split(",");
			sourceWords.push(items[0]);
			for (var j = 0; j < items.length; j++)
			{
				new_row.push(items[j]);
			}
			readyData.push(new_row);
		}
		
		// order from smallest to biggest
		var swap = true;
		while (swap)
		{				
			swap = false;
			for (var i = 0; i < readyData.length - 1; i++)
			{
				if (readyData[i].length > readyData[i + 1].length)
				{
					var b = readyData[i + 1];
					readyData[i + 1] = readyData[i];
					readyData[i] = b;
					
					b = sourceWords[i+1];
					sourceWords[i+1] = sourceWords[i];
					sourceWords[i] = b;
					
					swap = true;
				}
			}
		}
		
		if (clustersFlag)
		{
			for (var i = clustersFirstLineIndex; i < list_data.length; i++)
			{
				if (list_data[i].length < 5)
				{
					continue;
				}
				var new_row = [];
				var items = list_data[i].split(",");
				for (var j = 0; j < items.length; j++)
				{
					new_row.push(items[j]);
				}
				groups.push(new_row);
			}
		}
		
		try
		{
			wordIndex =  parseInt(localStorage.getItem("wordIndex"));
			if (wordIndex === null || isNaN(wordIndex))
			{
				wordIndex = 0;
			}
			else
			{
				wordIndex++;
				wordIndex--;
				alert("loaded last working location");
			}
			if (wordIndex < 0 || wordIndex > readyData.length)
			{
				wordIndex = 0;
			}
		}
		catch (error)
		{
			wordIndex = 0;
		}
		refreshScreen();
		setInterval(autoSave, 300000);
	}
	
	function refreshScreen()
	{
		var newResponseWords = "";
		for (var i = 1; i < readyData[wordIndex].length; i++)
		{
			if (!wordInGroups(readyData[wordIndex][i]))
			{
				newResponseWords += "(" + i + ") " + readyData[wordIndex][i] + "<br>";
			}
		}
		var groupsText = "";
		for (var i = 0; i < groups.length; i++)
		{
			groupsText += "קבוצה  (" + groups[i][0] + ")" + "<button class='btn btn-danger word-group-delete-btn' onclick='return deleteGroup(" + i + ")'>X</button>" + ": ";
			for (var j = 1; j < groups[i].length; j++)
			{
				groupsText += groups[i][j] + "<button class='btn btn-danger word-group-delete-btn' onclick='return deleteWordFromGroup(" + i + ", " + j + ")'>X</button>";
				if (j != groups[i].length - 1)
				{
					groupsText += ", ";
				}
				else
				{
					groupsText += ". (סה'כ " + (groups[i].length - 1) + " מילים)";
				}
			}
			groupsText += "<br>";
		}
		
		document.getElementById("IndexWord").innerHTML = "אינדקס בדיקה <br> " + (wordIndex + 1)+ " / " + readyData.length;
		document.getElementById("firstWord").innerHTML = "מילת גירוי<br> " + sourceWords[wordIndex] + " (0) ";
		document.getElementById("responseWords").innerHTML = newResponseWords;
		document.getElementById("groups").innerHTML = groupsText;
		document.getElementById('group_indexes').value = "";
		
		pb = document.getElementById('pb');
		pb.innerHTML = Math.floor(100 * (1 + wordIndex) / readyData.length) + "%";
		pb.style.width = (100 * (1 + wordIndex) / readyData.length) + "%";
		
		window.scrollTo(0, 0);
	}
	
	function deleteGroup(groupIndex)
	{
		groups.splice(groupIndex, 1);
		refreshScreen();
	}
	
	function deleteWordFromGroup(groupIndex, deleteWordIndex)
	{
		groups[groupIndex].splice(deleteWordIndex, 1);
		refreshScreen();
	}

	
	function addToGroup()
	{
		try
		{
			var groupName = document.getElementById('class_index').value.trim()
			var indexValues = document.getElementById('group_indexes').value;
			
			var foundGroupIndex = -1;
			for (var i = 0; i < groups.length; i++)
			{
				if (groupName == groups[i][0])
				{
					foundGroupIndex = i;
					break;
				}
			}
			
			if (foundGroupIndex == -1)
			{
				alert("While trying to add to group, the group with name " + groupName + " was not found");
				return;
			}
			
			var items = indexValues.split(",");
			for (var i = 0; i < items.length; i++)
			{
				try
				{
					var value = readyData[wordIndex][parseInt(items[i])];
					if (value.length > 1)
					{
						groups[foundGroupIndex].push(value);
						isChangeDone = true;
					}
				}
				catch (error)
				{
					alert("While trying to add to group, the word index " + items[i] + " was not found");
				}
			}
			refreshScreen();
		}
		catch (error)
		{
			alert("erorr at 'addToGroup': " + error);
		}
	}
	
	function addToNewGroup()
	{
		try
		{
			var groupName = document.getElementById('class_new_index').value.trim();
			var indexValues = document.getElementById('group_indexes').value;
			
			var foundGroupIndex = -1;
			for (var i = 0; i < groups.length; i++)
			{
				if (groupName == groups[i][0])
				{
					foundGroupIndex = i;
					break;
				}
			}
			
			if (foundGroupIndex != -1)
			{
				alert("While trying to add a new group, the group with name " + groupName + " was already found so the action has been stoped");
				return;
			}
			
			var items = indexValues.split(",");
			group_answers = [groupName];
			for (var i = 0; i < items.length; i++)
			{
				try
				{
					var value = readyData[wordIndex][parseInt(items[i])];
					if (value.length > 1)
					{
						group_answers.push(value);
						isChangeDone = true;
					}
				}
				catch (error)
				{
					alert("While trying to add to new group, the word index " + items[i] + " was not found");
				}
			}
			if (group_answers.length < 3)
			{
				alert("A group must contain at least 2 words");
			}
			else
			{
				groups.push(group_answers);
			}
			document.getElementById('class_new_index').value = "";
			reorderGroups();
			refreshScreen();
		}
		catch (error)
		{
			alert("erorr at 'addToNewGroup': " + error);
		}
	}
	
	function reorderGroups()
	{
		groups.sort(function(a, b)
		{
		  var keyA = a[0];
		  var keyB = b[0];
		  if (keyA < keyB) return -1;
		  if (keyA > keyB) return 1;
		  return 0;
		});
	}
	
	function next()
	{
		if (wordIndex + 1 == readyData.length)
		{
			alert("This is the final set, cannot go forward");
			return;
		}
		wordIndex += 1;
		localStorage.setItem("wordIndex", wordIndex);
		refreshScreen();
	}
	
	function jumpWordIndex()
	{
		try
		{
			var newWordIndex = parseInt(document.getElementById('jump_index').value) - 1;
			document.getElementById('jump_index').value = "";
			if (newWordIndex > readyData.length)
			{
				newWordIndex = readyData.length - 1;
			}
			else if (newWordIndex < 0)
			{
				newWordIndex = 0;
			}
			wordIndex = newWordIndex;
			localStorage.setItem("wordIndex", wordIndex);
			refreshScreen();
		}
		catch (error)
		{
			alert("Cannot perform the jump function because " + error);
		}
	}
	
	function previous()
	{
		if (wordIndex - 1 == -1)
		{
			alert("This is the first set, cannot go back");
			return;
		}
		wordIndex -= 1;
		localStorage.setItem("wordIndex", wordIndex);
		refreshScreen();
	}
	
	function autoSave()
	{
		if (isChangeDone)
		{
			isChangeDone = false;
			downloadData();
		}
	}
	
	function wordInGroups(checkWord)
	{
		try
		{
			for (var i = 0; i < groups.length; i++)
			{
				for (var j = 1; j < groups[i].length; j++)
				{
					if (checkWord == groups[i][j])
					{
						return true;
					}
				}
			}
			return false;
		}
		catch (error)
		{
			alert("erorr at 'wordInGroups': " + error);
		}
	}
	
	function downloadData()
	{
		var file_data = "";
		for (var i = 0; i < readyData.length; i++)
		{
			for (var j = 0; j < readyData[i].length; j++)
			{
				file_data += readyData[i][j];
				if (j != readyData[i].length - 1)
				{
					file_data += ",";
				}
			}
			file_data += "\n";
		}
		file_data += CLUSTER_DATA_SPLITER + "\n";
		for (var i = 0; i < groups.length; i++)
		{
			for (var j = 0; j < groups[i].length; j++)
				{
					file_data += groups[i][j];
					if (j != groups[i].length - 1)
					{
						file_data += ",";
					}
			}
			file_data += "\n";
		}
		
		downloadasTextFile("groups_data" + getCurrentTimeDateString() + ".csv", file_data);
	}
	
	function downloadasTextFile(filename, text) {
		var element = document.createElement('a');
		element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
		element.setAttribute('download', filename);

		element.style.display = 'none';
		document.body.appendChild(element);

		element.click();

		document.body.removeChild(element);
	}
	
	function getCurrentTimeDateString()
	{
		var today = new Date();
		var date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();
		var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
		var dateTime = date+' '+time;
		return dateTime;
	}
	</script>
</body>
</html>