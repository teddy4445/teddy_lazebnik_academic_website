<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <title>
   Clinical Study - Teddy Lazebnik
  </title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="A simple GUI for the clinical study developed by Teddy Lazebnik" name="description"/>
  <meta content="Teddy Lazebnik" name="author"/>
  <link href="../img/favicon.ico" rel="icon" type="image/x-icon"/>
  <!-- css -->
  <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" rel="stylesheet"/>
  <link href="../css/teddy_style.css" rel="stylesheet"/>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154895667-1">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-154895667-1');
  </script>
  <!-- Hotjar Tracking Code for http://teddylazebnik.info/ -->
  <script>
   (function(h,o,t,j,a,r){
			h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
			h._hjSettings={hjid:1812929,hjsv:6};
			a=o.getElementsByTagName('head')[0];
			r=o.createElement('script');r.async=1;
			r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
			a.appendChild(r);
		})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
  </script>
 </head>
 <body>
  <div id="progressBar">
  </div>
  <div id="ScrollPath">
  </div>
  <div class="row">
   <div class="col-lg-12 col-md-12 col-sm-12 mobile-space">
    <nav class="navbar navbar-expand-lg">
     <a class="navbar-brand" href="../index.html" id="logo" title="Theodore (Teddy) Lazebnik">
      Theodore (Teddy) Lazebnik
     </a>
     <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse" type="button">
      <img alt="menu" class="navbar-toggler-icon" src="https://img.icons8.com/ios-filled/50/000000/menu.png"/>
     </button>
     <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
       <li class="nav-item form-inline mobile" style="padding-bottom: 10px;">
        <input aria-label="Search" class="form-control input-search" id="search-data" placeholder="Search" type="search"/>
        <div class="input-group-append">
         <button class="btn btn-outline-white btn-search" onclick="return searchPage();">
          <img alt="search" src="https://img.icons8.com/android/24/000000/search.png"/>
         </button>
        </div>
       </li>
        <li class="nav-item">
        <a class="nav-link active" href="index.html" title="home page">
         Home
        </a>
       </li>
       <li class="nav-item dropdown">
        <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="navbarDropdown" role="button" title="Research">
         Research
        </a>
        <div aria-labelledby="navbarDropdown" class="dropdown-menu">
         <a class="dropdown-item" href="/publications.html" title="Academic Publications">
          Academic Publications
         </a>
         <a class="dropdown-item" href="/students.html" title="Research Students">
          Research Students
         </a>
        </div>
       </li>
       <li class="nav-item dropdown">
        <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="navbarDropdown" role="button" title="Teaching">
         Teaching
        </a>
        <div aria-labelledby="navbarDropdown" class="dropdown-menu">
         <h4 class="dropdown-item">
          Bar Ilan University
         </h4>
         <a class="dropdown-item" href="/courses/advanced-programming-one.html" title="Advanced Programming 1">
          Advanced Programming 1
         </a>
         <a class="dropdown-item" href="/courses/advanced-programming-two.html" title="Advanced Programming 2">
          Advanced Programming 2
         </a>
         <div class="dropdown-divider">
         </div>
         <a class="dropdown-item" href="/teaching.html" title="teaching">
          All classes
         </a>
        </div>
       </li>
       <li class="nav-item dropdown">
        <a aria-expanded="false" aria-haspopup="true" class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" id="navbarDropdown" role="button" title="Projects">
         Projects
        </a>
        <div aria-labelledby="navbarDropdown" class="dropdown-menu">
         <a class="dropdown-item" href="/opensource.html" title="Open Resources">
          Open Source 
         </a>
         <a class="dropdown-item" href="/technological-blog.html" title="Technological Blog">
          Technological Blog
         </a>
        </div>
       </li>
      </ul>
      <div class="form-inline my-2 my-lg-0 desktop">
       <input aria-label="Search" class="form-control input-search" id="search-data-2" placeholder="Search" type="search"/>
       <div class="input-group-append">
        <button class="btn btn-outline-white btn-search" onclick="return searchPage();">
         <img alt="search" src="https://img.icons8.com/android/24/000000/search.png"/>
        </button>
       </div>
      </div>
     </div>
    </nav>
    <div class="body">
     <div class="fluid-container">
      <div class="row">
       <div class="col-lg-12 col-md-12 col-sm-12">
        <div class="info">
         <div class="alert alert-danger alert-dismissible fade show" id="error-search" role="alert" style="display: none">
          <strong>
           Page Not found
          </strong>
          , I am still working on our inner website search engine. Try again or use the navigation bar.
          <button aria-label="Close" class="close" onclick="return closeSearchAlert()" type="button">
           <span aria-hidden="true">
            Ã—
           </span>
          </button>
         </div>
         <h1>
          Clinical Trial Data Machine Learning GUI
         </h1>
         <div id="panel">
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </div>
  </div>
 </body>
</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js">
</script>
<script crossorigin="anonymous" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" src="https://code.jquery.com/jquery-3.5.1.slim.min.js">
</script>
<script crossorigin="anonymous" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js">
</script>
<script crossorigin="anonymous" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js">
</script>
<script src="../js/main.js">
</script>
<script src="../js/search.js">
</script>
<script>
 let name_aki = "AKI01";
	let name_postComplication = "postComplication1Y2N";
	let parms_aki = ["Size_cm", "renalScore4_12", "age", "BaseHb", "OT", "EBL", "weight", "height", "creatinine"];
	let parms_postComplication = ["height", "collSysOpenY1N2", "Upper1Mid2Hillar3Lower4", "Central1Peripheral2", "renalScore4_12", "clinTNEW", "Ptnew", "pathologicN", "Pmnew", "worstGrade1_4", "creatinine"];
	
	generate_forms();
	
	function generate_forms()
	{
		generate_form(name_aki, "aki_form", parms_aki);
		generate_form(name_postComplication, "postComplication_form", parms_postComplication);
	}
	
	function list_to_str(items)
	{
		answer = "[";
		for (var i = 0; i < items.length; i++)
		{
			answer += "'" + items[i] + "',"
		}
		answer = answer.substring(0, answer.length - 1);
		answer += "]"
		return answer;
	}
	
	function generate_form(name, form_id, coloums)
	{
		var panel = document.getElementById("panel");
		panel.innerHTML += '<h3>' + name + ' prediction</h3><div class="card"><div class="card-body"><div id="' + form_id + '"></div></div></div><br><br>';
		panel_form = document.getElementById(form_id);
		var form_html = "";
		for (var i = 0; i < coloums.length; i++)
		{
			form_html += '<div class="form-group">';
			form_html += '<label id="label_' + name + '_' + coloums[i] + '" for="' + coloums[i] + '">' + coloums[i] + ' </label>';
			form_html += '<input type="text" class="form-control" id="' + name + '_' + coloums[i] + '" aria-describedby="' + coloums[i] + '" placeholder="' + coloums[i] + '">';
			form_html += '</div>';
		}
		form_html += '<br><button type="submit" class="cool-btn cool-btn-gray" id="predict_btn_' + name + '" onclick="return run_prediction(\'' + name + '\', ' + list_to_str(coloums) + ', predict_' + name + ');"> Predict </button>';
		form_html += '<br><br><p id="answer_' + name + '"> </p>';
		panel_form.innerHTML += form_html;
	}
	
	function run_prediction(name, parameters, sat)
	{
		var values = [];
		var is_broken = false;
		for (var i = 0; i < parameters.length; i++)
		{
			var new_val = document.getElementById(name + "_" + parameters[i]).value;
			if (new_val == "")
			{
				document.getElementById("label_" + name + "_" + parameters[i]).style.color = "red";
				if (!is_broken)
				{
					document.getElementById(name + "_" + parameters[i]).focus();
				}
				is_broken = true;
			}
			else
			{
				var float_new_val = parseFloat(new_val);
				if (!isNaN(float_new_val))
				{
					values.push(float_new_val);
					document.getElementById("label_" + name + "_" + parameters[i]).style.color = "black";
				}
				else
				{
					document.getElementById("label_" + name + "_" + parameters[i]).style.color = "red";
					var input_place = document.getElementById(name + "_" + parameters[i]);
					input_place.value = "";
					input_place.focus();
				}
			}
		}
		if (!is_broken)
		{
			var predict_with_conf = sat(values);
			document.getElementById("answer_" + name).innerHTML = "<h3>The prediction is: <b>" + predict_with_conf[0] + " with (" + predict_with_conf[1][0] + "% confidence) \n                because: " +  predict_with_conf[1][1] + "</b></h3>";
		}
		else
		{
			document.getElementById("answer_" + name).innerHTML = "";
		}
		// just to make sure the form won't break
		return false;
	}
	
	
function predict_postComplication1Y2N(values)
{
	path = []
	if (values[8] <= 1.7200000286102295)
	{
		path.push('Pmnew <= 1.7200000286102295')
		if (values[3] <= 16.25)
		{
			path.push('Central1Peripheral2 <= 16.25')
			if (values[4] <= 147.0)
			{
				path.push('renalScore4_12 <= 147.0')
				if (values[2] <= 61.5)
				{
					path.push('Upper1Mid2Hillar3Lower4 <= 61.5')
					if (values[6] <= 101.0)
					{
						path.push('Ptnew <= 101.0')
						return [0, check_path_postComplication1Y2N(path)];
					}
					else
					{
						path.push('Ptnew > 101.0')
						return [1, check_path_postComplication1Y2N(path)];
					}
				}
				else
				{
					path.push('Upper1Mid2Hillar3Lower4 > 61.5')
					if (values[5] <= 550.0)
					{
						path.push('clinTNEW <= 550.0')
						return [0, check_path_postComplication1Y2N(path)];
					}
					else
					{
						path.push('clinTNEW > 550.0')
						return [1, check_path_postComplication1Y2N(path)];
					}
				}
			}
			else
			{
				path.push('renalScore4_12 > 147.0')
				if (values[1] <= 6.5)
				{
					path.push('collSysOpenY1N2 <= 6.5')
					if (values[3] <= 11.050000190734863)
					{
						path.push('Central1Peripheral2 <= 11.050000190734863')
						return [1, check_path_postComplication1Y2N(path)];
					}
					else
					{
						path.push('Central1Peripheral2 > 11.050000190734863')
						return [0, check_path_postComplication1Y2N(path)];
					}
				}
				else
				{
					path.push('collSysOpenY1N2 > 6.5')
					if (values[6] <= 94.5)
					{
						path.push('Ptnew <= 94.5')
						return [1, check_path_postComplication1Y2N(path)];
					}
					else
					{
						path.push('Ptnew > 94.5')
						return [1, check_path_postComplication1Y2N(path)];
					}
				}
			}
		}
		else
		{
			path.push('Central1Peripheral2 > 16.25')
			return [1, check_path_postComplication1Y2N(path)];
		}
	}
	else
	{
		path.push('Pmnew > 1.7200000286102295')
		return [1, check_path_postComplication1Y2N(path)];
	}
}
	
function predict_AKI01(values)
{
	path = []
	if (values[8] <= 1.7200000286102295)
	{
		path.push('creatinine <= 1.7200000286102295')
		if (values[3] <= 16.25)
		{
			path.push('BaseHb <= 16.25')
			if (values[4] <= 147.0)
			{
				path.push('OT <= 147.0')
				if (values[2] <= 61.5)
				{
					path.push('age <= 61.5')
					if (values[6] <= 101.0)
					{
						path.push('weight <= 101.0')
						return [0, check_path_AKI01(path)];
					}
					else
					{
						path.push('weight > 101.0')
						return [1, check_path_AKI01(path)];
					}
				}
				else
				{
					path.push('age > 61.5')
					if (values[5] <= 550.0)
					{
						path.push('EBL <= 550.0')
						return [0, check_path_AKI01(path)];
					}
					else
					{
						path.push('EBL > 550.0')
						return [1, check_path_AKI01(path)];
					}
				}
			}
			else
			{
				path.push('OT > 147.0')
				if (values[1] <= 6.5)
				{
					path.push('renalScore4_12 <= 6.5')
					if (values[3] <= 11.050000190734863)
					{
						path.push('BaseHb <= 11.050000190734863')
						return [1, check_path_AKI01(path)];
					}
					else
					{
						path.push('BaseHb > 11.050000190734863')
						return [0, check_path_AKI01(path)];
					}
				}
				else
				{
					path.push('renalScore4_12 > 6.5')
					if (values[6] <= 94.5)
					{
						path.push('weight <= 94.5')
						return [1, check_path_AKI01(path)];
					}
					else
					{
						path.push('weight > 94.5')
						return [1, check_path_AKI01(path)];
					}
				}
			}
		}
		else
		{
			path.push('BaseHb > 16.25')
			return [1, check_path_AKI01(path)];
		}
	}
	else
	{
		path.push('creatinine > 1.7200000286102295')
		return [1, check_path_AKI01(path)];
	}
}

function check_path_AKI01(path_conditions)
{
	var scores = {};
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT <= 147.0 and age <= 61.5 and weight <= 101.0'] = 57.51;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT <= 147.0 and age > 61.5 and EBL <= 550.0'] = 50.64;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT > 147.0 and renalScore4_12 <= 6.5 and BaseHb > 11.050000190734863'] = 41.42;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT <= 147.0 and age <= 61.5 and weight > 101.0'] = 61.37;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT <= 147.0 and age > 61.5 and EBL > 550.0'] = 61.37;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT > 147.0 and renalScore4_12 <= 6.5 and BaseHb <= 11.050000190734863'] = 61.37;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT > 147.0 and renalScore4_12 > 6.5 and weight <= 94.5'] = 62.45;
	scores['creatinine <= 1.7200000286102295 and BaseHb <= 16.25 and OT > 147.0 and renalScore4_12 > 6.5 and weight > 94.5'] = 61.59;
	scores['creatinine <= 1.7200000286102295 and BaseHb > 16.25'] = 61.59;
	scores['creatinine > 1.7200000286102295'] = 63.95;
	var path_str = '';
	for (var i = 0; i < path_conditions.length; i++)
	{
		 path_str += path_conditions[i] + ' and ';
	}
	path_str = path_str.substring(0, path_str.length-5);
	return [scores[path_str], path_str];
}

function check_path_postComplication1Y2N(path_conditions)
{
	var scores = {};
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 <= 147.0 and Upper1Mid2Hillar3Lower4 <= 61.5 and Ptnew <= 101.0'] = 34.43;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 <= 147.0 and Upper1Mid2Hillar3Lower4 > 61.5 and clinTNEW <= 550.0'] = 100.0;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 > 147.0 and collSysOpenY1N2 <= 6.5 and Central1Peripheral2 > 11.050000190734863'] = 100.0;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 <= 147.0 and Upper1Mid2Hillar3Lower4 <= 61.5 and Ptnew > 101.0'] = 96.24;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 <= 147.0 and Upper1Mid2Hillar3Lower4 > 61.5 and clinTNEW > 550.0'] = 96.24;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 > 147.0 and collSysOpenY1N2 <= 6.5 and Central1Peripheral2 <= 11.050000190734863'] = 96.24;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 > 147.0 and collSysOpenY1N2 > 6.5 and Ptnew <= 94.5'] = 96.24;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 <= 16.25 and renalScore4_12 > 147.0 and collSysOpenY1N2 > 6.5 and Ptnew > 94.5'] = 96.24;
	scores['Pmnew <= 1.7200000286102295 and Central1Peripheral2 > 16.25'] = 96.24;
	scores['Pmnew > 1.7200000286102295'] = 63.69;
	var path_str = '';
	for (var i = 0; i < path_conditions.length; i++)
	{
		 path_str += path_conditions[i] + ' and ';
	}
	path_str = path_str.substring(0, path_str.length-5);
	return [scores[path_str], path_str];
}

</script>
